<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.animalhusbandry.mapper.AhAlarmRecordMapper">

    <!-- 获取最新的N条告警记录 -->
    <select id="getRecentAlarms" resultType="org.jeecg.modules.animalhusbandry.vo.RecentAlarmVo">
        SELECT
            ar.id,
            ar.animal_id,
            an.ear_tag_id,
            ar.alarm_type,
            ar.alarm_content,
            ar.alarm_level,
            ar.alarm_time
        FROM
            ah_alarm_record ar
        LEFT JOIN
            ah_animal an ON ar.animal_id = an.id
        ORDER BY
            ar.alarm_time DESC
        LIMIT #{limit}
    </select>

    <!-- 统计今天新增的告警数量 -->
    <select id="countNewAlarmsToday" resultType="int">
        SELECT
            COUNT(*)
        FROM
            ah_alarm_record
        WHERE
            alarm_time >= CURDATE()
    </select>

</mapper>
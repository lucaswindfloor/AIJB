# 设备监控系统测试数据说明

## 测试数据概述

此测试数据专为验证设备监控系统功能设计，包含了 **14个设备** 和 **5个牲畜**，覆盖了设备监控系统的所有关键场景。

## 测试场景设计

### 1. 设备KPI统计验证

**预期结果：**
- **设备总数：** 14个
- **在线设备：** 6个（最近12小时内有数据更新）
- **离线设备：** 5个（超过12小时未更新）
- **低电量设备：** 4个（电量<20%）

**具体分布：**
```
状态分布：
├── ACTIVE (在用): 9个设备
├── IDLE (闲置): 2个设备  
├── MAINTENANCE (维保中): 1个设备
└── IN_STOCK (库存中): 2个设备
```

### 2. 问题设备列表验证

系统应识别出 **5个问题设备**：

| 设备名称 | 问题类型 | 绑定牲畜 | 具体问题 |
|---------|---------|---------|----------|
| 瘤胃胶囊-C003 | 低电量 | 福星(EAR-003) | 电量15% |
| 追踪器-T003 | 低电量 | 未绑定 | 电量8% |
| 瘤胃胶囊-C004 | 离线 | 黑旋风(EAR-004) | 离线18小时 |
| 追踪器-T004 | 离线 | 未绑定 | 离线2天 |
| 瘤胃胶囊-C005 | 离线+低电量 | 白雪(EAR-005) | 离线3天+电量5% |

### 3. RPC指令发送验证

**可测试设备：**
- `DEV-001` (瘤胃胶囊-C001) → TB设备ID: `TB-CAP-001`
- `DEV-002` (瘤胃胶囊-C002) → TB设备ID: `TB-CAP-002`
- `DEV-003` (追踪器-T001) → TB设备ID: `TB-TRK-001`

**测试方法：**
```bash
POST /animal_husbandry/deviceMonitor/rpc
{
    "deviceId": "DEV-001",
    "command": "reboot",
    "params": {}
}
```

### 4. 维保任务创建验证

**推荐测试设备：**
- `DEV-005` (瘤胃胶囊-C003) - 低电量设备
- `DEV-007` (瘤胃胶囊-C004) - 离线设备

**测试效果：** 设备状态应从 `ACTIVE` 变更为 `MAINTENANCE`

### 5. 牲畜设备绑定关系验证

**绑定关系一览：**
```
大壮(EAR-001) ←→ 瘤胃胶囊-C001 + 追踪器-T001 (双设备绑定)
小花(EAR-002) ←→ 瘤胃胶囊-C002 + 追踪器-T002 (双设备绑定)
福星(EAR-003) ←→ 瘤胃胶囊-C003 (低电量问题设备)
黑旋风(EAR-004) ←→ 瘤胃胶囊-C004 (离线问题设备)  
白雪(EAR-005) ←→ 瘤胃胶囊-C005 (严重问题设备)
```

## 前端界面预期效果

### 1. 设备监控仪表盘顶部KPI卡片

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 设备总数    │ 在线设备    │ 离线设备    │ 低电量设备  │
│    14个     │    6个      │    5个      │    4个      │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

### 2. 问题设备列表

应显示5行记录，按严重程度排序（低电量优先，然后按离线时间）：

| 设备名称 | 类型 | DevEUI | 状态 | 电量 | 最后在线时间 | 绑定牲畜 | 操作 |
|---------|------|--------|------|------|-------------|---------|------|
| 瘤胃胶囊-C005 | 瘤胃胶囊 | EUI-CAP-005 | 离线 | 5% | 3天前 | 白雪 | 详情/重启/维保 |
| 追踪器-T003 | 追踪器 | EUI-TRK-003 | 在线 | 8% | 25分钟前 | - | 详情/重启/维保 |
| 瘤胃胶囊-C003 | 瘤胃胶囊 | EUI-CAP-003 | 在线 | 15% | 20分钟前 | 福星 | 详情/重启/维保 |
| 追踪器-T004 | 追踪器 | EUI-TRK-004 | 离线 | 45% | 2天前 | - | 详情/重启/维保 |
| 瘤胃胶囊-C004 | 瘤胃胶囊 | EUI-CAP-004 | 离线 | 60% | 18小时前 | 黑旋风 | 详情/重启/维保 |

## 执行测试数据

1. **执行SQL脚本：**
   ```bash
   mysql -u root -p jeecg-boot < device_monitor_test_data.sql
   ```

2. **启动后端服务**

3. **访问前端页面：**
   ```
   http://localhost:3100/#/animal_husbandry/device/monitor
   ```

4. **验证API接口：**
   ```bash
   # 获取KPI
   GET /animal_husbandry/deviceMonitor/kpis
   
   # 获取问题设备列表
   GET /animal_husbandry/deviceMonitor/problematicList?pageNo=1&pageSize=10
   
   # 发送重启指令
   POST /animal_husbandry/deviceMonitor/rpc
   
   # 创建维保任务
   POST /animal_husbandry/deviceMonitor/createMaintenanceTask
   ```

## 注意事项

1. **时间依赖性：** 测试数据使用相对时间（如 `DATE_SUB(NOW(), INTERVAL 18 HOUR)`），确保在任何时间执行都能产生正确的测试效果。

2. **数据清理：** 脚本开头会清空相关表数据，执行前请备份重要数据。

3. **关联数据：** 测试数据包含完整的关联关系，可以测试牲畜档案详情页中的设备信息展示。

4. **告警数据：** 包含了与问题设备相关的告警记录，可以验证告警与设备监控的联动效果。

## 扩展测试建议

1. **性能测试：** 可以通过脚本批量生成更多设备数据，测试分页查询性能。

2. **边界情况：** 测试电量为0%、长时间离线（30天以上）等极端情况。

3. **并发测试：** 同时发送多个RPC指令，测试系统并发处理能力。

4. **数据一致性：** 验证设备状态变更时，相关表的数据一致性。 
# 设备监控系统测试数据说明

## 执行方式

请在你的MySQL客户端中依次执行以下命令：

```bash
mysql -u root -p jeecg-boot < jeecg-boot/db/设备监控测试数据补充.sql
```

或者直接在MySQL命令行中运行该SQL文件。

## 测试数据设计

### 基于现有数据的改进策略

我们**保留了你现有的所有数据**，只是进行了以下增强：

1. **为现有5个设备补充了`update_time`字段** - 模拟不同的在线/离线状态
2. **调整了部分设备的电量** - 创建低电量告警场景  
3. **新增了6个设备** - 覆盖更多测试场景
4. **新增了1个牲畜（白雪）** - 用于绑定测试
5. **补充了设备绑定关系** - 测试绑定牲畜的问题设备
6. **新增了设备相关告警** - 验证告警系统

### 预期的设备监控KPI结果

执行补充脚本后，你应该看到以下KPI统计：

- **设备总数：** 11个（原5个 + 新增6个）
- **在线设备：** 5个（最近12小时内有update_time的设备）
- **离线设备：** 4个（超过12小时未更新的设备）
- **低电量设备：** 4个（电量<20%的设备）

### 问题设备列表测试场景

脚本执行后，系统应识别出以下**5个问题设备**：

| 设备名称 | 问题类型 | 绑定牲畜 | 具体问题 |
|---------|---------|---------|----------|
| 瘤胃胶囊C002 | 低电量 | 福星(EAR-003) | 电量15% |
| 追踪器T002 | 离线+低电量 | 小花(EAR-002) | 18小时离线+电量8% |
| 瘤胃胶囊C004 | 离线+低电量 | 黑旋风(EAR-004) | 3天离线+电量5% |
| 追踪器T003 | 低电量 | 未绑定 | 电量12% |
| 瘤胃胶囊C005 | 离线 | 白雪(EAR-005) | 2天离线 |

### 测试API接口

在后端`DeviceMonitorController`开发完成后，你可以通过以下方式验证：

#### 1. 获取设备KPI
```bash
GET /animal_husbandry/deviceMonitor/kpis
```
**预期响应：**
```json
{
  "total": 11,
  "online": 5, 
  "offline": 4,
  "lowBattery": 4
}
```

#### 2. 查询问题设备列表
```bash
GET /animal_husbandry/deviceMonitor/problematicList?pageNo=1&pageSize=10
```
**预期响应：** 返回5条问题设备记录

#### 3. 发送RPC指令测试
```bash
POST /animal_husbandry/deviceMonitor/rpc
Content-Type: application/json

{
  "deviceId": "DEV-CAP-002",
  "command": "reboot",
  "description": "重启设备以解决低电量问题"
}
```

#### 4. 创建维保任务测试
```bash
POST /animal_husbandry/deviceMonitor/createMaintenanceTask
Content-Type: application/json

{
  "deviceId": "DEV-TRK-002", 
  "taskType": "更换电池",
  "assignee": "张三",
  "notes": "设备电量过低，需要更换电池"
}
```

## 数据一致性验证

脚本末尾包含了验证查询，执行后你可以看到：

1. **设备监控KPI验证** - 确认在线/离线/低电量设备数量
2. **问题设备列表验证** - 显示所有有问题的设备详情
3. **最新设备状态分布** - 各状态设备的数量和占比
4. **最新告警统计** - 按类型和级别统计告警数量

## 下一步开发建议

1. **前端开发：** 基于这些测试数据，开发`DeviceDashboard.vue`页面
2. **API联调：** 使用这些场景测试所有设备监控相关接口
3. **图表验证：** 验证历史遥测数据图表功能（需要时序数据库配合）
4. **端到端测试：** 测试从问题发现到维保任务创建的完整流程

## 重置数据

如果需要重置到执行前的状态，可以执行：

```sql
-- 删除新增的设备
DELETE FROM ah_device WHERE id IN ('DEV-CAP-004', 'DEV-TRK-003', 'DEV-CAP-005', 'DEV-TRK-004', 'DEV-CAP-006', 'DEV-TRK-005', 'DEV-CAP-007', 'DEV-TRK-006');

-- 删除新增的牲畜
DELETE FROM ah_animal WHERE id = 'ANIMAL-005';

-- 删除新增的告警记录
DELETE FROM ah_alarm_record WHERE alarm_type = 'a_device_offline';

-- 重置现有设备的状态
UPDATE ah_device SET update_time = NULL, battery_level = 95 WHERE id = 'DEV-CAP-001';
UPDATE ah_device SET update_time = NULL, battery_level = 88 WHERE id = 'DEV-CAP-002';  
UPDATE ah_device SET update_time = NULL, battery_level = 100 WHERE id = 'DEV-TRK-001';
UPDATE ah_device SET update_time = NULL, battery_level = 99 WHERE id = 'DEV-TRK-002';
``` 